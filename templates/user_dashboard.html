<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Turno - Nurstem</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nurse.css') }}">
</head>
<body>

    <div class="main-layout">
        
        <aside class="sidebar">
            <div class="brand"><h2>Nurstem</h2></div>
            <nav class="nav-menu">
                <a href="{{ url_for('user_dashboard') }}" class="nav-link active">Mis Pacientes</a>
                
                <a href="{{ url_for('triage_ingreso') }}" class="nav-link">ğŸš‘ AdmisiÃ³n Urgencias</a>
                
                <a href="{{ url_for('consumo_insumos') }}" class="nav-link">ğŸ’Š Insumos y Material</a>
                <a href="{{ url_for('portal_capacitacion') }}" class="nav-link">ğŸ“ CapacitaciÃ³n</a>
                <a href="#" class="nav-link">Cerrar Turno</a>
            </nav>
            
            <div class="user-profile-widget">
                <div class="avatar-circle">
                    {{ usuario.nombre[0] }}{{ usuario.apellidos[0] }}
                </div>
                <div class="profile-info">
                    <span class="profile-name">{{ usuario.nombre }} {{ usuario.apellidos }}</span>
                    <span class="profile-role">
                        {{ usuario.rol.nombre if usuario.rol else 'EnfermerÃ­a' }}
                    </span>
                </div>
            </div>
        </aside>

        <main class="content-area">
            
            <div class="nurse-container">
                
                <div class="shift-header">
                    <div class="shift-info">
                        <h1>Tablero de Guardia</h1>
                        <p style="color: #64748b; font-size: 0.9rem; margin-top: 5px;">
                            ğŸ“… {{ fecha_actual }}
                        </p>
                        
                        <div class="shift-badges">
                            {% if area_actual != "Sin AsignaciÃ³n" %}
                                <span class="badge-pill badge-blue">Turno: {{ turno_actual }}</span>
                                <span class="badge-pill badge-purple">ğŸ“ {{ area_actual }}</span>
                            {% else %}
                                <span class="badge-pill" style="background:#fee2e2; color:#991b1b; border:1px solid #fecaca;">
                                    âš ï¸ No tienes asignaciÃ³n activa hoy
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="shift-actions">
                        <button class="btn-secondary" onclick="alert('NotificaciÃ³n enviada a Jefatura')">
                            ğŸ“£ Reportar Incidencia
                        </button>
                    </div>
                </div>

                <div class="tasks-summary">
                    <div class="task-card task-urgent">
                        <span class="task-icon">â°</span>
                        <div class="task-text">
                            <strong>Pendientes</strong>
                            <span>Revisar indicaciones</span>
                        </div>
                    </div>
                    <div class="task-card">
                        <span class="task-icon">ğŸ‘¥</span>
                        <div class="task-text">
                            <strong>Carga de Trabajo</strong>
                            <span>{{ pacientes|length }} Pacientes asignados</span>
                        </div>
                    </div>
                </div>

                <h3 class="section-title">Pacientes a mi cargo ({{ pacientes|length }})</h3>
                
                <div class="patient-grid">
                    
                    {% for paciente in pacientes %}
                    <div class="patient-card">
                        <div class="patient-header">
                            <div class="bed-indicator">ID: {{ paciente.id }}</div>
                            <span class="status-dot dot-stable" title="Estable"></span>
                        </div>
                        
                        <div class="patient-body">
                            <h4 class="patient-name">{{ paciente.nombre }} {{ paciente.apellidos }}</h4>
                            
                            <p class="patient-dx">
                                <strong>Nacimiento:</strong> 
                                {{ paciente.fecha_nacimiento if paciente.fecha_nacimiento else 'No registrado' }}
                            </p>
                            
                            <div class="vitals-preview">
                                <div class="vital-item">
                                    <span class="label">GÃ©nero</span>
                                    <span class="value" style="font-size:0.9rem;">{{ paciente.genero }}</span>
                                </div>
                                <div class="vital-item">
                                    <span class="label">MÃ©dico</span>
                                    <span class="value" style="font-size:0.9rem;">
                                        {{ paciente.medico.nombre if paciente.medico else 'General' }}
                                    </span>
                                </div>
                            </div>

                            <div class="alerts-container">
                                <span class="alert-tag" style="background:#f1f5f9; color:#475569;">
                                    Ver Historial ClÃ­nico
                                </span>
                            </div>
                        </div>
                        
                        <div class="patient-actions">
                            <a href="{{ url_for('hoja_view', paciente_id=paciente.id) }}" class="btn-action primary-action">Hoja de EnfermerÃ­a</a>
                            <button class="btn-action secondary-action">Kardex</button>
                        </div>
                    </div>
                    {% else %}
                    <div style="grid-column: 1/-1; text-align: center; padding: 4rem; background: white; border-radius: 12px; border: 2px dashed #cbd5e1;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ›ï¸</div>
                        <h3 style="color: #64748b;">No hay pacientes visibles</h3>
                        <p style="color: #94a3b8; max-width: 400px; margin: 0 auto;">
                            Esto puede deberse a que no tienes una asignaciÃ³n de Ã¡rea para hoy, 
                            o el Ã¡rea asignada ({{ area_actual }}) no tiene pacientes ingresados.
                        </p>
                        <br>
                        <a href="{{ url_for('admin_asignaciones') }}" style="color:var(--color-primary); font-weight:bold;">
                            Ir a Asignaciones (Admin)
                        </a>
                    </div>
                    {% endfor %}

                </div>

            </div>
        </main>
    </div>
</body>
</html>