<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard General - Nurstem</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>

    <div class="main-layout">
        
        <aside class="sidebar">
            <div class="brand"><h2>Nurstem</h2></div>
            <nav class="nav-menu">
                <a href="{{ url_for('admin_personal') }}" class="nav-link">Personal</a>
                <a href="{{ url_for('admin_pacientes') }}" class="nav-link">Pacientes</a>
                <a href="{{ url_for('admin_asignaciones') }}" class="nav-link">Asignaciones</a>
                <a href="{{ url_for('admin_dashboard') }}" class="nav-link active">Dashboard</a>
                <a href="{{ url_for('admin_capacitacion') }}" class="nav-link">Capacitaci√≥n</a>
                <a href="{{ url_for('admin_inventario') }}" class="nav-link">Inventario</a>
            </nav>
        </aside>

        <main class="content-area">
            
            <div class="dashboard-container">
                
                <div class="dashboard-header">
                    <div>
                        <h1>Panel de Control</h1>
                        <p>Resumen operativo en tiempo real</p>
                    </div>
                    <div class="date-indicator">
                        <span id="currentDate">{{ fecha_actual }}</span>
                    </div>
                </div>

                <div class="kpi-grid">
                    <div class="card kpi-card">
                        <div class="kpi-icon icon-blue">üõèÔ∏è</div>
                        <div class="kpi-info">
                            <h3>Pacientes Ingresados</h3>
                            <p class="kpi-value">{{ total_pacientes }}</p>
                            <span class="kpi-sub">Total Hospital</span>
                        </div>
                    </div>
                    
                    <div class="card kpi-card">
                        <div class="kpi-icon icon-red">üöë</div>
                        <div class="kpi-info">
                            <h3>Urgencias</h3>
                            <p class="kpi-value">{{ urgencias_count }}</p>
                            <span class="kpi-sub">En valoraci√≥n</span>
                        </div>
                    </div>

                    <div class="card kpi-card">
                        <div class="kpi-icon icon-green">üë©‚Äç‚öïÔ∏è</div>
                        <div class="kpi-info">
                            <h3>Enfermer√≠a Activa</h3>
                            <p class="kpi-value">{{ total_enfermeros }}</p>
                            <span class="kpi-sub">Personal en turno</span>
                        </div>
                    </div>

                    <div class="card kpi-card">
                        <div class="kpi-icon icon-orange">‚ö†Ô∏è</div>
                        <div class="kpi-info">
                            <h3>Alertas Stock</h3>
                            <p class="kpi-value">{{ count_alertas }}</p>
                            <span class="kpi-sub">Insumos cr√≠ticos</span>
                        </div>
                    </div>
                </div>

                <div class="main-dashboard-grid">
                    
                    <div class="column-left">
                        
                        <div class="card section-card">
                            <div class="card-header">
                                <h3>Ocupaci√≥n por √Årea</h3>
                            </div>
                            <div class="occupancy-list">
                                {% for area in ocupacion_data %}
                                <div class="occupancy-item">
                                    <div class="area-info">
                                        <span>{{ area.nombre }}</span>
                                        <span class="percentage">{{ area.porcentaje }}% ({{ area.pacientes }}/{{ area.capacidad }})</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill {{ area.color }}" style="width: {{ area.porcentaje }}%;"></div>
                                    </div>
                                </div>
                                {% else %}
                                <p style="padding: 1rem; color: #666;">No hay √°reas configuradas.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="card section-card">
                            <div class="card-header">
                                <h3>√öltimos Pacientes Registrados</h3>
                            </div>
                            <table class="simple-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Paciente</th>
                                        <th>√Årea</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for p in ultimos_pacientes %}
                                    <tr>
                                        <td>#{{ p.id }}</td>
                                        <td><strong>{{ p.nombre }} {{ p.apellidos }}</strong></td>
                                        <td>
                                            {% if p.area %}
                                                {{ p.area.nombre }}
                                            {% else %}
                                                <span style="color:orange">En espera</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="column-right">
                        
                        <div class="card section-card">
                            <div class="card-header">
                                <h3 class="text-danger">‚ö† Stock Bajo (&lt;15)</h3>
                            </div>
                            <div class="stock-alerts-list">
                                {% for med in alertas_list %}
                                <div class="stock-item">
                                    <div class="stock-info">
                                        <strong>{{ med.nombre }}</strong>
                                        <small>Lote: {{ med.lote or 'N/A' }}</small>
                                    </div>
                                    <div class="stock-badge badge-critical">{{ med.stock }} u.</div>
                                </div>
                                {% else %}
                                <div class="stock-item">
                                    <span style="color:green">‚úî Inventario Saludable</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="card section-card">
                            <div class="card-header">
                                <h3>Accesos R√°pidos</h3>
                            </div>
                            <div class="quick-links">
                                <button class="btn-quick-action" onclick="window.location.href='{{ url_for('admin_pacientes') }}'">
                                    <span>‚ûï</span> Nuevo Ingreso
                                </button>
                                <button class="btn-quick-action" onclick="window.location.href='{{ url_for('admin_personal') }}'">
                                    <span>üë•</span> Gestionar Personal
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

        </main>
    </div>
</body>
</html>